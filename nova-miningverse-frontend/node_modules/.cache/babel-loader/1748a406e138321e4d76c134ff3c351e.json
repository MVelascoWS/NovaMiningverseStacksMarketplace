{"ast":null,"code":"const GLOBAL_DETECTION_CACHE_KEY = '_blockstackDidCheckEchoReply';\nconst ECHO_REPLY_PARAM = 'echoReply';\nconst AUTH_CONTINUATION_PARAM = 'authContinuation';\n\nfunction getQueryStringParams(query) {\n  if (!query) {\n    return {};\n  }\n\n  const trimmed = /^[?#]/.test(query) ? query.slice(1) : query;\n  return trimmed.split('&').reduce((params, param) => {\n    const [key, value] = param.split('=');\n    params[key] = value ? decodeURIComponent(value.replace(/\\+/g, ' ')) : '';\n    return params;\n  }, {});\n}\n\nexport function protocolEchoReplyDetection() {\n  let globalScope;\n\n  if (typeof self !== 'undefined') {\n    globalScope = self;\n  } else if (typeof window !== 'undefined') {\n    globalScope = window;\n  } else {\n    return false;\n  }\n\n  if (!globalScope.location || !globalScope.localStorage) {\n    return false;\n  }\n\n  const existingDetection = globalScope[GLOBAL_DETECTION_CACHE_KEY];\n\n  if (typeof existingDetection === 'boolean') {\n    return existingDetection;\n  }\n\n  const searchParams = getQueryStringParams(globalScope.location.search);\n  const echoReplyParam = searchParams[ECHO_REPLY_PARAM];\n\n  if (echoReplyParam) {\n    globalScope[GLOBAL_DETECTION_CACHE_KEY] = true;\n    const echoReplyKey = `echo-reply-${echoReplyParam}`;\n    globalScope.localStorage.setItem(echoReplyKey, 'success');\n    globalScope.setTimeout(() => {\n      const authContinuationParam = searchParams[AUTH_CONTINUATION_PARAM];\n      globalScope.location.href = authContinuationParam;\n    }, 10);\n    return true;\n  }\n\n  return false;\n}","map":{"version":3,"mappings":"AAOA,MAAMA,0BAA0B,GAAG,8BAAnC;AACA,MAAMC,gBAAgB,GAAG,WAAzB;AACA,MAAMC,uBAAuB,GAAG,kBAAhC;;AAEA,SAASC,oBAAT,CAA8BC,KAA9B,EAA2C;EACzC,IAAI,CAACA,KAAL,EAAY;IACV,OAAO,EAAP;EACD;;EAED,MAAMC,OAAO,GAAG,QAAQC,IAAR,CAAaF,KAAb,IAAsBA,KAAK,CAACG,KAAN,CAAY,CAAZ,CAAtB,GAAuCH,KAAvD;EACA,OAAOC,OAAO,CAACG,KAAR,CAAc,GAAd,EAAmBC,MAAnB,CAA0B,CAACC,MAAD,EAASC,KAAT,KAAkB;IACjD,MAAM,CAACC,GAAD,EAAMC,KAAN,IAAeF,KAAK,CAACH,KAAN,CAAY,GAAZ,CAArB;IACAE,MAAM,CAACE,GAAD,CAAN,GAAcC,KAAK,GAAGC,kBAAkB,CAACD,KAAK,CAACE,OAAN,CAAc,KAAd,EAAqB,GAArB,CAAD,CAArB,GAAmD,EAAtE;IACA,OAAOL,MAAP;EACD,CAJM,EAIJ,EAJI,CAAP;AAKD;;AAaD,OAAM,SAAUM,0BAAV,GAAoC;EAExC,IAAIC,WAAJ;;EACA,IAAI,OAAOC,IAAP,KAAgB,WAApB,EAAiC;IAC/BD,WAAW,GAAGC,IAAd;EACD,CAFD,MAEO,IAAI,OAAOC,MAAP,KAAkB,WAAtB,EAAmC;IACxCF,WAAW,GAAGE,MAAd;EACD,CAFM,MAEA;IAEL,OAAO,KAAP;EACD;;EAED,IAAI,CAACF,WAAW,CAACG,QAAb,IAAyB,CAACH,WAAW,CAACI,YAA1C,EAAwD;IAEtD,OAAO,KAAP;EACD;;EAGD,MAAMC,iBAAiB,GAAIL,WAAmB,CAACjB,0BAAD,CAA9C;;EACA,IAAI,OAAOsB,iBAAP,KAA6B,SAAjC,EAA4C;IAC1C,OAAOA,iBAAP;EACD;;EAED,MAAMC,YAAY,GAAGpB,oBAAoB,CAACc,WAAW,CAACG,QAAZ,CAAqBI,MAAtB,CAAzC;EACA,MAAMC,cAAc,GAAGF,YAAY,CAACtB,gBAAD,CAAnC;;EACA,IAAIwB,cAAJ,EAAoB;IACjBR,WAAmB,CAACjB,0BAAD,CAAnB,GAAkD,IAAlD;IAGD,MAAM0B,YAAY,GAAG,cAAcD,cAAc,EAAjD;IAGAR,WAAW,CAACI,YAAZ,CAAyBM,OAAzB,CAAiCD,YAAjC,EAA+C,SAA/C;IAIAT,WAAW,CAACW,UAAZ,CAAuB,MAAK;MAC1B,MAAMC,qBAAqB,GAAGN,YAAY,CAACrB,uBAAD,CAA1C;MACAe,WAAW,CAACG,QAAZ,CAAqBU,IAArB,GAA4BD,qBAA5B;IACD,CAHD,EAGG,EAHH;IAKA,OAAO,IAAP;EACD;;EAED,OAAO,KAAP;AACD","names":["GLOBAL_DETECTION_CACHE_KEY","ECHO_REPLY_PARAM","AUTH_CONTINUATION_PARAM","getQueryStringParams","query","trimmed","test","slice","split","reduce","params","param","key","value","decodeURIComponent","replace","protocolEchoReplyDetection","globalScope","self","window","location","localStorage","existingDetection","searchParams","search","echoReplyParam","echoReplyKey","setItem","setTimeout","authContinuationParam","href"],"sources":["D:\\Projects\\NovaMiningverse\\Nova-Miningverse\\nova-miningverse-frontend\\node_modules\\@stacks\\connect-react\\node_modules\\@stacks\\auth\\src\\protocolEchoDetection.ts"],"sourcesContent":["/**\n * This logic is in a separate file with no dependencies so that it can be\n * loaded and executed as soon as possible to fulfill the purpose of the protocol\n * detection technique. The effectiveness of this is obviously subject to how web\n * apps bundle/consume the blockstack.js lib.\n */\n\nconst GLOBAL_DETECTION_CACHE_KEY = '_blockstackDidCheckEchoReply';\nconst ECHO_REPLY_PARAM = 'echoReply';\nconst AUTH_CONTINUATION_PARAM = 'authContinuation';\n\nfunction getQueryStringParams(query: string): Record<string, string> {\n  if (!query) {\n    return {};\n  }\n  // Trim a starting `?` character if exists\n  const trimmed = /^[?#]/.test(query) ? query.slice(1) : query;\n  return trimmed.split('&').reduce((params, param) => {\n    const [key, value] = param.split('=');\n    params[key] = value ? decodeURIComponent(value.replace(/\\+/g, ' ')) : '';\n    return params;\n  }, {} as Record<string, string>);\n}\n\n/**\n * Checks if the current window location URL contains an 'echoReply' parameter\n * which indicates that this page was only opened to signal back to the originating\n * tab that the protocol handler is installed.\n * If found, then localStorage events are used to notify the other tab,\n * and this page is redirected back to the Blockstack authenticator URL.\n * This function caches its result and will not trigger multiple redirects when\n * invoked multiple times.\n * @returns True if detected and the page will be automatically redirected.\n * @hidden\n */\nexport function protocolEchoReplyDetection(): boolean {\n  // Check that the `window` APIs exist\n  let globalScope: Window;\n  if (typeof self !== 'undefined') {\n    globalScope = self;\n  } else if (typeof window !== 'undefined') {\n    globalScope = window;\n  } else {\n    // Exit detection function - we are not running in a browser environment.\n    return false;\n  }\n\n  if (!globalScope.location || !globalScope.localStorage) {\n    // Exit detection function - we are not running in a browser environment.\n    return false;\n  }\n\n  // Avoid performing the check twice and triggered multiple redirect timers.\n  const existingDetection = (globalScope as any)[GLOBAL_DETECTION_CACHE_KEY];\n  if (typeof existingDetection === 'boolean') {\n    return existingDetection;\n  }\n\n  const searchParams = getQueryStringParams(globalScope.location.search);\n  const echoReplyParam = searchParams[ECHO_REPLY_PARAM];\n  if (echoReplyParam) {\n    (globalScope as any)[GLOBAL_DETECTION_CACHE_KEY] = true;\n\n    // Use localStorage to notify originated tab that protocol handler is available and working.\n    const echoReplyKey = `echo-reply-${echoReplyParam}`;\n\n    // Set the echo-reply result in localStorage for the other window to see.\n    globalScope.localStorage.setItem(echoReplyKey, 'success');\n\n    // Redirect back to the localhost auth url, as opposed to another protocol launch.\n    // This will re-use the same tab rather than creating another useless one.\n    globalScope.setTimeout(() => {\n      const authContinuationParam = searchParams[AUTH_CONTINUATION_PARAM];\n      globalScope.location.href = authContinuationParam;\n    }, 10);\n\n    return true;\n  }\n\n  return false;\n}\n"]},"metadata":{},"sourceType":"module"}